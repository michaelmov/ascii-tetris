var p=Object.defineProperty;var f=(a,t,e)=>t in a?p(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var r=(a,t,e)=>f(a,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class S{constructor(t,e){r(this,"rows");r(this,"cols");r(this,"empty");r(this,"grid");this.rows=t,this.cols=e,this.empty=0,this.grid=Array.from({length:t},()=>Array(e).fill(this.empty))}isValidMove(t,e,n){for(let s=0;s<t.length;s++)for(let i=0;i<t[0].length;i++)if(t[s][i]){const o=e+s,h=n+i;if(o<0||o>=this.rows||h<0||h>=this.cols||this.grid[o][h]!==this.empty)return!1}return!0}mergePiece(t,e){const n=t.getShape();for(let s=0;s<n.length;s++)for(let i=0;i<n[0].length;i++)n[s][i]&&(this.grid[e.row+s][e.col+i]=1)}clearLines(){let t=0;for(let e=this.rows-1;e>=0;e--)this.grid[e].every(n=>n!==this.empty)&&(this.grid.splice(e,1),this.grid.unshift(Array(this.cols).fill(this.empty)),t++,e++);return t}reset(){this.grid=Array.from({length:this.rows},()=>Array(this.cols).fill(this.empty))}getCell(t,e){return this.grid[t][e]}getGrid(){return this.grid}}class v{constructor(){r(this,"score");r(this,"lines");r(this,"level");r(this,"gameOver");r(this,"isPaused");this.score=0,this.lines=0,this.level=1,this.gameOver=!1,this.isPaused=!1}updateScore(t){t>0&&(this.score+=t*100,this.lines+=t,this.level=1+Math.floor(this.lines/10))}reset(){this.score=0,this.lines=0,this.level=1,this.gameOver=!1,this.isPaused=!1}togglePause(){this.isPaused=!this.isPaused}setGameOver(){this.gameOver=!0}getScore(){return this.score}getLines(){return this.lines}getLevel(){return this.level}isGameOver(){return this.gameOver}getIsPaused(){return this.isPaused}}class w{constructor(t){r(this,"game");r(this,"touchStartX");r(this,"touchStartY");r(this,"lastTapTime");r(this,"SWIPE_THRESHOLD",50);r(this,"DOUBLE_TAP_DELAY",300);this.game=t,this.touchStartX=null,this.touchStartY=null,this.lastTapTime=0,this.setupEventListeners()}setupEventListeners(){document.addEventListener("keydown",t=>{if(!this.game.getIsStarted()){this.game.start();return}switch(t.key){case"r":case"R":this.game.restart();return}if(!this.game.getGameState().isGameOver())switch(t.key){case"ArrowLeft":case"7":this.game.move(-1);break;case"ArrowRight":case"9":this.game.move(1);break;case"ArrowUp":case"8":this.game.rotatePiece();break;case"ArrowDown":case"4":this.game.moveDown();break;case" ":case"5":this.game.drop();break;case"p":case"P":this.game.togglePause();break}}),document.addEventListener("touchstart",t=>{if(!this.game.getIsStarted()||this.game.getGameState().isGameOver())return;this.touchStartX=t.touches[0].clientX,this.touchStartY=t.touches[0].clientY;const e=Date.now();e-this.lastTapTime<this.DOUBLE_TAP_DELAY&&(this.game.drop(),t.preventDefault()),this.lastTapTime=e}),document.addEventListener("touchend",t=>{if(!this.game.getIsStarted()||!this.touchStartX||!this.touchStartY||this.game.getGameState().isGameOver())return;const e=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY,s=e-this.touchStartX,i=n-this.touchStartY;Math.abs(s)<this.SWIPE_THRESHOLD&&Math.abs(i)<this.SWIPE_THRESHOLD?this.game.rotatePiece():Math.abs(s)>Math.abs(i)?s>0?this.game.move(1):this.game.move(-1):i>0&&this.game.drop(),this.touchStartX=null,this.touchStartY=null,t.preventDefault()}),document.addEventListener("touchmove",t=>{!this.game.getIsStarted()||this.game.getGameState().isGameOver()||t.preventDefault()})}}const d=class d{constructor(t=null){r(this,"shape");this.shape=t?JSON.parse(JSON.stringify(t)):this.getRandomPiece().shape}getRandomPiece(){const t=Math.floor(Math.random()*d.PIECES.length);return JSON.parse(JSON.stringify(d.PIECES[t]))}rotate(){this.shape=this.shape[0].map((t,e)=>this.shape.map(n=>n[e]).reverse())}getWidth(){return this.shape[0].length}getHeight(){return this.shape.length}getShape(){return this.shape}};r(d,"PIECES",[{shape:[[1,1],[1,1]]},{shape:[[1,1,1,1]]},{shape:[[1,1,0],[0,1,1]]},{shape:[[1,0],[1,0],[1,1]]},{shape:[[1,1,1],[0,1,0]]}]);let u=d;class y{constructor(t){r(this,"ROWS");r(this,"COLS");r(this,"TICK_MS");r(this,"board");r(this,"gameState");r(this,"renderer");r(this,"inputHandler");r(this,"current");r(this,"next");r(this,"position");r(this,"isStarted");r(this,"tickInterval");this.ROWS=25,this.COLS=10,this.TICK_MS=500,this.board=new S(this.ROWS,this.COLS),this.gameState=new v,this.renderer=t,this.inputHandler=new w(this),this.current=null,this.next=null,this.position=null,this.isStarted=!1,this.tickInterval=null}start(){if(!this.isStarted){const t=document.getElementById("start-screen"),e=document.getElementById("tetris-container");t&&e&&(t.style.display="none",e.style.display="flex"),this.isStarted=!0,this.spawnPiece(),this.tickInterval=window.setInterval(()=>this.tick(),this.TICK_MS)}}spawnPiece(){this.current=this.next||new u,this.next=new u,this.position={row:0,col:Math.floor((this.COLS-this.current.getWidth())/2)},this.board.isValidMove(this.current.getShape(),this.position.row,this.position.col)||this.gameState.setGameOver()}tick(){if(!(this.gameState.isGameOver()||this.gameState.getIsPaused())){if(this.board.isValidMove(this.current.getShape(),this.position.row+1,this.position.col))this.position.row++;else{this.board.mergePiece(this.current,this.position);const t=[];for(let e=this.ROWS-1;e>=0;e--)this.board.getGrid()[e].every(n=>n!==0)&&t.push(e);if(t.length>0){this.renderer.setLinesToClear(t),this.render(),setTimeout(()=>{const e=this.board.clearLines();this.gameState.updateScore(e),this.renderer.setLinesToClear([]),this.spawnPiece(),this.render()},300);return}else this.spawnPiece()}this.render()}}move(t){this.board.isValidMove(this.current.getShape(),this.position.row,this.position.col+t)&&(this.position.col+=t,this.render())}moveDown(){this.board.isValidMove(this.current.getShape(),this.position.row+1,this.position.col)&&(this.position.row++,this.render())}drop(){for(;this.board.isValidMove(this.current.getShape(),this.position.row+1,this.position.col);)this.position.row++;this.tick()}rotatePiece(){this.current.rotate(),this.board.isValidMove(this.current.getShape(),this.position.row,this.position.col)||(this.current.rotate(),this.current.rotate(),this.current.rotate()),this.render()}togglePause(){this.gameState.togglePause(),this.render()}restart(){this.tickInterval&&window.clearInterval(this.tickInterval),this.gameState.reset(),this.board.reset(),this.current=null,this.next=null,this.position=null,this.spawnPiece(),this.tickInterval=window.setInterval(()=>this.tick(),this.TICK_MS),this.render()}render(){this.renderer.render(this.board,this.current,this.next,this.position,this.gameState)}getIsStarted(){return this.isStarted}getGameState(){return this.gameState}}class E{constructor(t,e,n,s){r(this,"gameBoard");r(this,"nextPiece");r(this,"scoreboard");r(this,"instructions");r(this,"linesToClear");this.gameBoard=t,this.nextPiece=e,this.scoreboard=n,this.instructions=s,this.linesToClear=new Set}setLinesToClear(t){this.linesToClear=new Set(t)}render(t,e,n,s,i){this.renderBoard(t,e,s,i),this.renderNext(n),this.renderScore(i),this.renderInstructions()}renderBoard(t,e,n,s){let i="";for(let o=0;o<t.getGrid().length;o++){i+="<!";for(let h=0;h<t.getGrid()[0].length;h++){let g=t.getCell(o,h)!==0,m=this.linesToClear.has(o);if(!s.isGameOver()&&e)for(let l=0;l<e.getShape().length;l++)for(let c=0;c<e.getShape()[0].length;c++)e.getShape()[l][c]&&o===n.row+l&&h===n.col+c&&(g=!0);if(g)if(m){const l=["█","▓","▒","░"],c=Math.floor(Date.now()/50)%l.length;i+=`[${l[c]}]`}else i+="[ ]";else i+=" . "}i+=`!>
`}i+="<!".padEnd(t.getGrid()[0].length*3+2,"=")+`!>
`,s.isGameOver()?i+=`
GAME OVER!
Press R to play again`:s.getIsPaused()&&(i+=`
PAUSED`),this.gameBoard.textContent=i}renderNext(t){let e=`NEXT:
`;for(let n=0;n<t.getShape().length;n++){for(let s=0;s<t.getShape()[0].length;s++)e+=t.getShape()[n][s]?"[ ]":"   ";e+=`
`}this.nextPiece.textContent=e}renderScore(t){this.scoreboard.textContent=`LINES CLEARED: ${t.getLines()}
LEVEL: ${t.getLevel()}
SCORE: ${t.getScore()}`}renderInstructions(){this.instructions.textContent=`INSTRUCTIONS:
7/←: LEFT   9/→: RIGHT
8/↑: ROTATE
4/↓: SOFT DROP
5/SPACE: HARD DROP
P: PAUSE    R: RESTART`}}const P=new E(document.getElementById("game-board"),document.getElementById("next-piece"),document.getElementById("scoreboard"),document.getElementById("instructions")),O=new y(P);window.onload=()=>{const a=document.getElementById("start-screen"),t=document.getElementById("tetris-container");a&&t&&(a.style.display="flex",t.style.display="none",a.addEventListener("click",()=>{a.style.display="none",t.style.display="block",O.start()}))};
//# sourceMappingURL=index-WluJI-dJ.js.map
