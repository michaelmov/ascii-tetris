(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();class p{rows;cols;empty;grid;constructor(t,e){this.rows=t,this.cols=e,this.empty=0,this.grid=Array.from({length:t},()=>Array(e).fill(this.empty))}isValidMove(t,e,i){for(let r=0;r<t.length;r++)for(let s=0;s<t[0].length;s++)if(t[r][s]){const n=e+r,o=i+s;if(n<0||n>=this.rows||o<0||o>=this.cols||this.grid[n][o]!==this.empty)return!1}return!0}mergePiece(t,e){const i=t.getShape();for(let r=0;r<i.length;r++)for(let s=0;s<i[0].length;s++)i[r][s]&&(this.grid[e.row+r][e.col+s]=1)}clearLines(){let t=0;for(let e=this.rows-1;e>=0;e--)this.grid[e].every(i=>i!==this.empty)&&(this.grid.splice(e,1),this.grid.unshift(Array(this.cols).fill(this.empty)),t++,e++);return t}reset(){this.grid=Array.from({length:this.rows},()=>Array(this.cols).fill(this.empty))}getCell(t,e){return this.grid[t][e]}getGrid(){return this.grid}}class f{score;lines;level;gameOver;isPaused;constructor(){this.score=0,this.lines=0,this.level=1,this.gameOver=!1,this.isPaused=!1}updateScore(t){t>0&&(this.score+=t*100,this.lines+=t,this.level=1+Math.floor(this.lines/10))}reset(){this.score=0,this.lines=0,this.level=1,this.gameOver=!1,this.isPaused=!1}togglePause(){this.isPaused=!this.isPaused}setGameOver(){this.gameOver=!0}getScore(){return this.score}getLines(){return this.lines}getLevel(){return this.level}isGameOver(){return this.gameOver}getIsPaused(){return this.isPaused}}class S{game;touchStartX;touchStartY;SWIPE_THRESHOLD=50;constructor(t){this.game=t,this.touchStartX=null,this.touchStartY=null,this.setupEventListeners()}setupEventListeners(){document.addEventListener("keydown",e=>{if(!this.game.getIsStarted()){this.game.start();return}switch(e.key){case"r":case"R":this.game.restart();return}if(!this.game.getGameState().isGameOver())switch(e.key){case"ArrowLeft":case"7":this.game.move(-1);break;case"ArrowRight":case"9":this.game.move(1);break;case"ArrowUp":case"8":this.game.rotatePiece();break;case"ArrowDown":case"4":this.game.moveDown();break;case" ":case"5":this.game.drop();break;case"p":case"P":this.game.togglePause(),this.updatePauseButtonText();break}});const t=document.getElementById("pause-button");t&&(t.addEventListener("click",()=>this.handleButtonClick()),t.addEventListener("touchend",e=>{e.preventDefault(),this.handleButtonClick()})),document.addEventListener("touchstart",e=>{const i=e.target;i.tagName==="A"||i.closest("a")||!this.game.getIsStarted()||this.game.getGameState().isGameOver()||(this.touchStartX=e.touches[0].clientX,this.touchStartY=e.touches[0].clientY)},{passive:!0}),document.addEventListener("touchend",e=>{const i=e.target;if(i.tagName==="A"||i.closest("a")||!this.game.getIsStarted()||!this.touchStartX||!this.touchStartY||this.game.getGameState().isGameOver())return;const r=document.getElementById("pause-button"),s=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY;if(r){const c=r.getBoundingClientRect();if(s>=c.left&&s<=c.right&&n>=c.top&&n<=c.bottom){this.touchStartX=null,this.touchStartY=null;return}}const o=s-this.touchStartX,l=n-this.touchStartY;Math.abs(o)<this.SWIPE_THRESHOLD&&Math.abs(l)<this.SWIPE_THRESHOLD?this.game.rotatePiece():Math.abs(o)>Math.abs(l)?o>0?this.game.move(1):this.game.move(-1):l>0?this.game.drop():this.game.moveDown(),this.touchStartX=null,this.touchStartY=null},{passive:!0}),document.addEventListener("touchmove",e=>{const i=e.target;i.tagName==="A"||i.closest("a")||!this.game.getIsStarted()||this.game.getGameState().isGameOver()},{passive:!0})}updatePauseButtonText(){const t=document.getElementById("pause-button");t&&(this.game.getGameState().isGameOver()?t.textContent="RESTART":t.textContent=this.game.getGameState().getIsPaused()?"RESUME":"PAUSE")}handleButtonClick(){this.game.getGameState().isGameOver()?this.game.restart():this.game.getIsStarted()&&!this.game.getGameState().isGameOver()&&this.game.togglePause(),this.updatePauseButtonText()}}class d{static PIECES=[{shape:[[1,1],[1,1]]},{shape:[[1,1,1,1]]},{shape:[[1,1,0],[0,1,1]]},{shape:[[1,0],[1,0],[1,1]]},{shape:[[0,1],[0,1],[1,1]]},{shape:[[1,1,1],[0,1,0]]}];shape;constructor(t=null){this.shape=t?JSON.parse(JSON.stringify(t)):this.getRandomPiece().shape}getRandomPiece(){const t=Math.floor(Math.random()*d.PIECES.length);return JSON.parse(JSON.stringify(d.PIECES[t]))}rotate(){this.shape=this.shape[0].map((t,e)=>this.shape.map(i=>i[e]).reverse())}getWidth(){return this.shape[0].length}getHeight(){return this.shape.length}getShape(){return this.shape}}class g{static audioContext=null;static isInitialized=!1;static init(){if(!this.isInitialized)try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioContext.resume().catch(()=>{}),this.isInitialized=!0}catch{this.audioContext=null,this.isInitialized=!0}}static playLineClear(t){if(!t||t<=0||(this.audioContext||this.init(),!this.audioContext))return;const e=this.audioContext;e.resume();const i=e.currentTime,r=.08,s=.05;for(let n=0;n<t;n++){const o=i+n*(r+s);this.scheduleBeep(e,o,r,900+n*120)}}static scheduleBeep(t,e,i,r){const s=t.createOscillator(),n=t.createGain();s.type="square",s.frequency.setValueAtTime(r,e);const o=.08;n.gain.setValueAtTime(1e-4,e),n.gain.exponentialRampToValueAtTime(o,e+.01),n.gain.exponentialRampToValueAtTime(1e-4,e+i),s.connect(n),n.connect(t.destination),s.start(e),s.stop(e+i+.01)}}var m=(a=>(a.NONE="",a.PAUSED="PAUSED",a.GAME_OVER='GAME OVER!<p class="blink-animation hide-on-mobile">Press R to play again</p>',a.LEVEL_UP='<p class="blink-animation">LEVEL UP!</p>',a))(m||{});class v{gameBoard;nextPiece;scoreboard;instructions;gameMessage;linesToClear;customMessage;customMessageTimeout;constructor(t,e,i,r,s){this.gameBoard=t,this.nextPiece=e,this.scoreboard=i,this.instructions=r,this.gameMessage=s,this.linesToClear=new Set,this.customMessage="",this.customMessageTimeout=null}setLinesToClear(t){this.linesToClear=new Set(t)}render(t,e,i,r,s){this.renderBoard(t,e,r,s),this.renderNext(i),this.renderScore(s),this.renderInstructions(),this.renderGameMessage(s)}renderBoard(t,e,i,r){let s="";for(let n=0;n<t.getGrid().length;n++){s+="<!";for(let o=0;o<t.getGrid()[0].length;o++){let l=t.getCell(n,o)!==0,c=this.linesToClear.has(n);if(!r.isGameOver()&&e)for(let h=0;h<e.getShape().length;h++)for(let u=0;u<e.getShape()[0].length;u++)e.getShape()[h][u]&&n===i.row+h&&o===i.col+u&&(l=!0);if(l)if(c){const h=["█","▓","▒","░"],u=Math.floor(Date.now()/50)%h.length;s+=`[${h[u]}]`}else s+="[ ]";else s+=" . "}s+=`!>
`}s+="<!".padEnd(t.getGrid()[0].length*3+2,"=")+`!>
`,this.gameBoard.textContent=s}renderNext(t){let e=`NEXT:
`;for(let i=0;i<t.getShape().length;i++){for(let r=0;r<t.getShape()[0].length;r++)e+=t.getShape()[i][r]?"[ ]":"   ";e+=`
`}this.nextPiece.textContent=e}renderScore(t){this.scoreboard.textContent=`LINES CLEARED: ${t.getLines()}
LEVEL: ${t.getLevel()}
SCORE: ${t.getScore()}`}renderInstructions(){this.instructions.textContent=`INSTRUCTIONS:
7/←: LEFT   9/→: RIGHT
8/↑: ROTATE
4/↓: SOFT DROP
5/SPACE: HARD DROP
P: PAUSE    R: RESTART`}renderGameMessage(t){if(this.customMessage){this.gameMessage.innerHTML=this.customMessage;return}let e="";t.isGameOver()?e='GAME OVER!<p class="blink-animation hide-on-mobile">Press R to play again</p>':t.getIsPaused()&&(e="PAUSED"),this.gameMessage.innerHTML=e}setCustomMessage(t,e){this.customMessageTimeout&&(window.clearTimeout(this.customMessageTimeout),this.customMessageTimeout=null),this.customMessage=t,e&&e>0&&(this.customMessageTimeout=window.setTimeout(()=>{this.customMessage="",this.customMessageTimeout=null},e))}}class E{ROWS;COLS;board;gameState;renderer;inputHandler;current;next;position;isStarted;tickInterval;currentLevel;constructor(t){this.ROWS=25,this.COLS=10,this.board=new p(this.ROWS,this.COLS),this.gameState=new f,this.renderer=t,this.inputHandler=new S(this),this.current=null,this.next=null,this.position=null,this.isStarted=!1,this.tickInterval=null,this.currentLevel=1}getTickSpeed(){return Math.max(50,800-(this.currentLevel-1)*83)}updateTickSpeed(){this.tickInterval&&(window.clearInterval(this.tickInterval),this.tickInterval=window.setInterval(()=>this.tick(),this.getTickSpeed()))}start(){if(!this.isStarted){const t=document.getElementById("start-screen"),e=document.getElementById("tetris-container");t&&e&&(t.style.display="none",e.style.display="flex"),g.init(),this.isStarted=!0,this.spawnPiece(),this.tickInterval=window.setInterval(()=>this.tick(),this.getTickSpeed())}}spawnPiece(){this.current=this.next||new d,this.next=new d,this.position={row:0,col:Math.floor((this.COLS-this.current.getWidth())/2)},this.board.isValidMove(this.current.getShape(),this.position.row,this.position.col)||(this.gameState.setGameOver(),this.inputHandler.updatePauseButtonText())}tick(){if(!(this.gameState.isGameOver()||this.gameState.getIsPaused())){if(this.board.isValidMove(this.current.getShape(),this.position.row+1,this.position.col))this.position.row++;else{this.board.mergePiece(this.current,this.position);const t=[];for(let e=this.ROWS-1;e>=0;e--)this.board.getGrid()[e].every(i=>i!==0)&&t.push(e);if(t.length>0){this.renderer.setLinesToClear(t),this.render(),setTimeout(()=>{const e=this.board.clearLines();this.gameState.updateScore(e),g.playLineClear(e);const i=this.gameState.getLevel();i!==this.currentLevel&&(this.currentLevel=i,this.updateTickSpeed(),this.renderer.setCustomMessage(m.LEVEL_UP,2e3)),this.renderer.setLinesToClear([]),this.spawnPiece(),this.render()},300);return}else this.spawnPiece()}this.render()}}move(t){this.gameState.getIsPaused()||this.board.isValidMove(this.current.getShape(),this.position.row,this.position.col+t)&&(this.position.col+=t,this.render())}moveDown(){this.gameState.getIsPaused()||this.board.isValidMove(this.current.getShape(),this.position.row+1,this.position.col)&&(this.position.row++,this.render())}drop(){if(!this.gameState.getIsPaused()){for(;this.board.isValidMove(this.current.getShape(),this.position.row+1,this.position.col);)this.position.row++;this.tick()}}rotatePiece(){this.gameState.getIsPaused()||(this.current.rotate(),this.board.isValidMove(this.current.getShape(),this.position.row,this.position.col)||(this.current.rotate(),this.current.rotate(),this.current.rotate()),this.render())}togglePause(){this.gameState.togglePause(),this.render()}restart(){this.tickInterval&&window.clearInterval(this.tickInterval),this.gameState.reset(),this.board.reset(),this.current=null,this.next=null,this.position=null,this.currentLevel=1,this.spawnPiece(),this.tickInterval=window.setInterval(()=>this.tick(),this.getTickSpeed()),this.render()}render(){this.renderer.render(this.board,this.current,this.next,this.position,this.gameState)}getIsStarted(){return this.isStarted}getGameState(){return this.gameState}}const w=new v(document.getElementById("game-board"),document.getElementById("next-piece"),document.getElementById("scoreboard"),document.getElementById("instructions"),document.getElementById("game-message")),y=new E(w);window.onload=()=>{const a=document.getElementById("start-screen"),t=document.getElementById("tetris-container");let e=!1;if(document.addEventListener("touchstart",i=>{i.touches.length>1&&i.preventDefault()},{passive:!1}),a&&t){a.style.display="flex",t.style.display="none";const i=r=>{const s=r.target;s.tagName==="A"||s.closest("a")||(r.preventDefault(),e||(e=!0,a.style.display="none",t.style.display="flex",y.start()))};document.body.addEventListener("click",i),document.body.addEventListener("touchend",i)}};
//# sourceMappingURL=index-Dbc7SDNb.js.map
